<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="utf-8">
        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
        <link href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
        <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.4/js/bootstrap.min.js"></script>
        <script src="http://dev.ehouais.net/webviews/webviews.js"></script>
        <style>
            body {
                overflow: hidden;
            }
            .template {
                display: none;
            }
            .tab-pane >iframe {
                border: none;
                width: 100%;
                height: 100%;
            }
            .nav-pills {
                padding: 4px;
            }
            .nav-pills li a {
                padding: 2px 4px;
                margin-left: 2px;
            }
        </style>
    </head>
    <body>
        <ul class="nav nav-pills" role="tablist">
            <li class="template" role="presentation"><a aria-controls="home" role="tab" data-toggle="tab"></a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane template" role="tabpanel">
                <iframe></iframe>
            </div>
        </div>
        <script>
            var Tabs = Webviews.data(),
                $tlst = $('body >.nav-pills'),
                $ttpl = $('li', $tlst).detach().removeClass('template'),
                $tplst = $('body >.tab-content'),
                $tptpl = $('>.tab-pane', $tplst).detach().removeClass('template');

            Tabs.bind(function(data) {
                // data = {favicon: URI, tabs: [{label: string, uri: URI}, ...]}
                var tabs = JSON.parse(data);

                // Set eventual favicon
                tabs.favicon && $('<link>').attr({rel: 'icon', type: 'image/png', href: tabs.favicon}).appendTo($('head'));

                // reset DOM on reload
                $tlst.empty();
                $tplst.empty();

                // create tabs and tabpanes
                tabs.tabs.forEach(function(tab, i) {
                    var id = 'tabpane_'+i,
                        $tab = $ttpl.clone().appendTo($tlst),
                        $link = $('a', $tab),
                        $tabpane = $tptpl.clone().appendTo($tplst),
                        $iframe = $('>iframe', $tabpane);

                    // init tab link
                    $link.attr('href', '#'+id)
                    $link.text(tab.label);
                    // init tabpane
                    $tabpane.attr('id', id);
                    // lazy load tabpane iframe content on link click
                    $link.on('shown.bs.tab', function() {
                        if (!$iframe.attr('src')) $iframe.attr('src', tab.uri);
                    });

                });

                // resize iframe taking tabs height into account
                (window.onresize = function() {
                    $('iframe').height($(window).height()-$tlst.outerHeight());
                })();

                // Show first tab
                $('>li a', $tlst).eq(0).tab('show');
            });
        </script>
    </body>
</html>
